# 天気予報機能 実装ロードマップ

## 概要

ホーム画面に、ユーザーが設定した地点の天気予報を表示する機能を実装する。

## フェーズ1: 基本機能の実装（地点を固定）

まずは、特定の地点（例：「東京」）の天気を表示する基本機能を実装し、レイアウトの問題を確実に解決する。

1.  **依存パッケージの確認**
    -   `pubspec.yaml` に `http` と `flutter_dotenv` が含まれていることを確認する。

2.  **APIキーの確認**
    -   プロジェクトルートの `.env` ファイルに `OPENWEATHERMAP_API_KEY` が設定されていることを前提とする。
    -   `main.dart` がアプリ起動時に `.env` を読み込んでいることを確認する。

3.  **既存ファイルのレビュー**
    -   `lib/models/weather.dart`: OpenWeatherMapのJSONレスポンスを正しく解析できるか確認する。
    -   `lib/services/weather_service.dart`: APIリクエストのURL構築、API呼び出し、エラーハンドリングが正しく行われるか確認する。

4.  **UIへの統合（段階的アプローチ）**
    -   **ステップ4.1 (状態変数の追加):** `home_screen.dart` に天気データ（`_currentWeather`）、ローディング状態（`_isLoadingWeather`）、エラー情報（`_weatherError`）を管理する状態変数を追加する。
    -   **ステップ4.2 (データ取得処理):** `_fetchWeather` メソッドを追加し、固定の都市（"Tokyo"）の天気情報を取得する処理を実装する。
    -   **ステップ4.3 (UIウィジェット作成):** 天気情報を表示する `_buildWeatherWidget` メソッドを作成する。
    -   **ステップ4.4 (分離デバッグ):** レイアウトの問題を切り分けるため、`home_screen.dart` の `body` 全体を一時的に `Center(child: _buildWeatherWidget())` のみに置き換える。これにより、他のUIコンポーネントから完全に独立した状態で、天気ウィジェット自体のレイアウトが正しく機能するかを確認する。
    -   **ステップ4.5 (最終レイアウトへの統合):** ステップ4.4でウィジェットの表示が正しいことを確認した後、`home_screen.dart` の `body` を元のレイアウトに戻し、`Stack` と `Align` を使って天気ウィジェットを画面下部に配置する。

## フェーズ2: 地点設定機能（将来的なタスク）

1.  設定画面に、ユーザーが天気予報の地点（都市名）を入力できるフィールドを追加する。
2.  設定された都市名を `SharedPreferences` に保存する。
3.  `_fetchWeather` メソッドを更新し、保存された都市名を利用して天気を取得するように変更する。設定がない場合はデフォルトの都市（例：「東京」）を利用する。

---

## 変更履歴



- **2025-10-13 (8):**

  - **天気予報機能の改善:** 3時間ごとの予報APIを利用し、24時間以内に雨が予報されている場合に「、のち雨」と表示するように修正しました。

- **2025-10-13 (7):**

  - **天気予報機能の改善:** 市区町村が未入力の場合に、より正確な天気予報を表示するため、都道府県の県庁所在地の天気を表示するように修正しました。

- **2025-10-13 (6):**

  - **天気予報機能の改善:** 市区町村が未入力の場合、都道府県の天気予報を表示するように修正しました。

- **2025-10-13 (5):**

  - **天気予報機能の改善:** 設定画面のUIを、都道府県（ドロップダウン選択）と市区町村（テキスト入力）に分割。より正確な地点設定を可能にしました。

- **2025-10-13 (4):**

  - **天気予報機能の改善:** 天気予報の検索対象を日本国内に限定しました。

- **2025-10-13 (3):**

  - **天気予報機能の改善:** 天気表示に都道府県名も含まれるように修正。`WeatherService`がジオコーディングAPIから取得した都道府県・市区町村名を返すようにし、ホーム画面のUIを更新しました。

- **2025-10-13 (2):**

  - **天気予報機能の改善:** `WeatherService`を更新し、OpenWeatherMapのジオコーディングAPIを利用するように変更。これにより、設定画面で日本語の都市名（例：「東京」）が利用可能になりました。

- **2025-10-13 (1):**

  - **天気予報機能(フェーズ2):**

    - 設定画面に「天気予報の地点」設定を追加。

    - ユーザーが入力した都市名を`SharedPreferences`に保存する機能を実装。

    - ホーム画面で保存された都市名を読み込み、その地点の天気を表示するように修正。

  - **天気予報機能(フェーズ1):**

    - `http`, `flutter_dotenv` パッケージを追加。

    - 天気情報表示のための `Weather` モデルと `WeatherService` を作成。

    - ホーム画面に天気ウィジェットを追加し、デバッグとレイアウト修正を実施。最終的に `Column` と `Expanded` を利用して画面下部に安定して配置。

    - ユーザーからのフィードバックに基づき、表示位置を微調整。














