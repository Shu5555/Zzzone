# Zzzone - 睡眠管理アプリ

## 概要
Zzzoneは、日々の睡眠を記録・可視化し、さらに全国のユーザーと睡眠時間を競い合うことで、健康的で楽しい睡眠習慣をサポートするモバイルアプリケーションです。新たに、偉人たちの「名言」を集めるガチャ機能や、アプリ内のお知らせ機能が追加され、コレクションとカスタマイズの楽しみが広がりました。

## 主な機能

### 1. 睡眠記録と評価
- **自動計測・手動記録:** 日々の睡眠を手軽に、または詳細に記録できます。
- **睡眠評価:** 睡眠スコア、体感パフォーマンス、二度寝の有無など、多角的に睡眠を評価します。
- **目標達成:** 設定した目標入眠時刻を守ることで、ゲーム感覚で睡眠習慣の改善を目指せます。

### 2. ガチャ機能と名言コレクション
- **名言ガチャ:** 睡眠時間に応じて獲得できる「スリープコイン」を使い、古今東西の偉人たちの「名言」を獲得できるガチャを引くことができます。
- **名言の検索:** 名言一覧画面では、キーワードで名言や著者名を検索できます（ひらがな・カタカナの区別なし）。
- **名言のコピー:** 名言一覧で、好きな名言を長押しすると、そのテキストをクリップボードにコピーできます。
- **レアリティ:** 名言には「コモン」「レア」「激レア」などのレアリティが設定されており、確率に基づいた抽選が行われます。
- **10連ガチャ:** 1回分お得に、一度に10個の名言を獲得できる10連ガチャも搭載しています。
- **ガチャ履歴:** これまで引いたガチャの結果をすべて時系列で確認できます。
- **演出:** ガチャを引く際には、獲得した名言の最高レアリティに応じたアニメーション演出が再生されます。
- **ポイント:** ガチャを1回引くごとに1ポイントが貯まります。
- **新着表示:** ガチャで初めて獲得した名言には「NEW!」マークが表示されます。
- **超激レア確定ガチャチケット:**
  - ショップの「ポイント」タブで100ポイントと交換できるチケットです。
  - このチケットを使用すると、必ず「超激レア」レアリティの名言を獲得できます。（「OWN_CHIN」レアリティは対象外です）
  - チケットを所持している場合のみ、ガチャ画面に専用のボタンが表示されます。

### 3. ホーム画面のカスタマイズ
- **お気に入り名言:** 「名言一覧」画面から、獲得した名言の中から好きなものを「お気に入り」に設定できます。設定した名言はホーム画面に常に表示されます。
- **ランダムモード:** 「お気に入り」を設定せず、「ランダムモード」をONにすると、獲得した名言の中から日替わりで異なる名言がホーム画面に表示されます。

### 4. 履歴と分析
- **睡眠履歴:** グラフやカレンダー形式で、過去の睡眠記録を直感的に振り返ることができます。記録を長押しすることで、内容の編集も可能です。
- **AIによる睡眠分析:** 5件以上の睡眠記録を元に、AI(Google Gemini 2.5 Pro)があなたの睡眠傾向を分析します。分析項目に「昼間の眠気」「二度寝」が追加され、よりパーソナルな内容になりました。また、状況に応じて「良い点」「改善点」の項目数が2〜4個に変動します。

### 5. 設定
- **目標入眠時刻:** 目標とする就寝時刻を設定できます。目標を守ることで、睡眠習慣の改善に繋がります。
- **天気予報の地点:** ホーム画面に表示する天気予報の地域を設定できます。
- **AIアシスタント設定:** 睡眠分析レポートを読み上げるAIアシスタントの個性を設定できます。
  - **口調設定:** AIの口調を、全16種類（デフォルト含む）の中から選択できます。（通常、丁寧、友達風、執事風、ツンデレ、カウンセラー、保育士、研究者、アンドロイド、賢者、おっとり系、クール系、元気いっぱい、お姉さん、天才少女）
  - **AIに認識される性別:** AIがあなたを認識する際の性別（男性、女性、未記入）を設定できます。ペルソナによっては、この設定に応じて呼びかけなどが変化します。

### 6. ショップ
- **タブ切り替え:** ショップは「背景色」と「ガチャ」の2つのタブで構成されています。
- **背景色の購入:** スリープコインを使い、ランキング画面で利用できる背景色を購入できます。

### 7. プロフィールと睡眠時間ランキング
- **プロフィール画面:** ユーザー名やランキングへの参加設定を管理できます。
- **全国ランキング:** 全ユーザーのその日の睡眠時間を集計し、ランキング形式で表示します。
- **名言ランキング:** ランキング画面右上のボタンから、各ランカーが設定している「お気に入り名言」をランキング順に見ることができます。

### 8. 天気予報
- **ホーム画面での表示:** ホーム画面の下部に、設定した地点の現在の天気、気温、今後の雨の予報（例：「晴れ、のち雨」）が表示されます。

### 9. ギフトコード機能
- **コード入力:** 管理者から配布されるギフトコードを入力することで、スリープコインや「超激レア確定ガチャチケット」などの特別なアイテムを獲得できます。
- **利用方法:** プロフィール画面の「ギフトコード」メニューから入力画面にアクセスできます。

### 10. ぐっすりサタデー
- **スリープコイン2倍:** 金曜日の午前4:00から土曜日の午前3:59までの間に睡眠を記録すると、獲得できるスリープコインが通常の2倍になります。
- **ホーム画面表示:** 対象期間中、ホーム画面の名言の上に大きな黄色の「S」が表示され、特別な日であることをお知らせします。

### 11. お知らせ機能
- **更新情報:** ホーム画面右上のアイコンから、アプリの更新情報や開発からのお知らせを確認できます。
- **未読バッジ:** 未読のお知らせがある場合、アイコンに赤い点が表示され、新しい情報があることを知らせます。
- **更新方法 (v5時点):**
  1. プロジェクト内の `assets/announcements.json` ファイルを開きます。
  2. 既存の形式に倣い、新しいお知らせ情報をJSONオブジェクトとして配列の先頭に追加します。
     - `id`は他と重複しないユニークな文字列にしてください。
     - `createdAt`は現在時刻などを `YYYY-MM-DDTHH:MM:SS+09:00` の形式で記述してください。
  3. ファイルを保存した後、アプリを再ビルドすると、新しいお知らせが反映されます。
  
  > **Note:** 現在の仕様では、お知らせの更新にアプリ自体のアップデートが必要です。将来的には、アプリのアップデートなしで更新できる仕組み（フェーズ3）への移行を計画しています。

---

## アーキテクチャ (v5)

### クライアントサイド
- **フレームワーク:** Flutter (Dart)
- **ローカルデータベース:** SQLite (`sqflite`) / Web向けインメモリ + `shared_preferences`
  - **保存データ:** 睡眠記録、獲得した名言リスト、ガチャの履歴、**お知らせの未読状態**
- **状態管理/設定保存:** `shared_preferences`
- **お知らせデータ:** `assets/announcements.json` (ローカル)
- **APIクライアント:** `http`
- **環境変数管理:** 
  - **デバッグモード:** `.env` ファイル (`flutter_dotenv`)
  - **リリースモード:** コンパイル時環境変数 (`--dart-define`)

### バックエンド
- **ランキング・通貨・ギフトコード管理:** Supabase (PostgreSQL)
- **AI分析機能:** Google Gemini 2.5 Pro API
- **天気予報:** OpenWeatherMap API

---

## 開発環境のセットアップ

(省略)

---

## 開発者情報
- **アプリ名:** Zzzone（ズォーン）
- **制作者名:** kou09427,syuu55
- **共同編集:** Gemini-1.5-pro